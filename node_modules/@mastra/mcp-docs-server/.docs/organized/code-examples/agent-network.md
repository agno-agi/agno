### package.json
```json
{
  "name": "examples-agent-network",
  "dependencies": {
    "@ai-sdk/anthropic": "^1.2.12",
    "@ai-sdk/openai": "^1.3.24",
    "@mastra/client-js": "latest",
    "@mastra/core": "latest",
    "@mastra/libsql": "latest",
    "@mastra/loggers": "latest",
    "@mastra/memory": "latest",
    "mastra": "latest",
    "zod": "^3.25.76"
  }
}
```

### agent-workflow.ts
```typescript
import { mastra } from './mastra';

async function main() {
  const wflow = mastra.getWorkflow('agentWorkflow');

  const { runId, start } = wflow.createRun();

  const result = await start({
    triggerData: {
      prompt: 'What is the capital of France?',
    },
  });

  console.log(JSON.stringify(result, null, 2));
}

main().catch(console.error);

```

### index.ts
```typescript
import { mastra } from './mastra';

async function main() {
  const researchNetwork = mastra.getNetwork('Research_Network');

  if (!researchNetwork) {
    throw new Error('Research network not found');
  }

  console.log('ðŸ” Starting research on Napoleon Bonaparte...\n');

  // Generate a report using the research network
  // Using the generate() method as per the API update (MEMORY[8bf54da9-89a8-4e5b-b875-234a1aa8a53b])
  const result = await researchNetwork.stream('Give me a report on Napoleon Bonaparte', {
    maxSteps: 20, // Allow enough steps for the LLM router to determine the best agents to use
  });

  for await (const part of result.fullStream) {
    switch (part.type) {
      case 'error':
        console.error(part.error);
        break;
      case 'text-delta':
        process.stdout.write(part.textDelta);
        break;
      case 'tool-call':
        console.log(`calling tool ${part.toolName} with args ${JSON.stringify(part.args, null, 2)}`);
        break;
      case 'tool-result':
        console.log(`tool result ${JSON.stringify(part.result, null, 2)}`);
        break;
    }
  }

  // Display the final result
  console.log('\n\nðŸ“ Final Research Report:\n');

  console.log('\n\nðŸ“Š Agent Interaction Summary:');
  console.log(researchNetwork.getAgentInteractionSummary());

  console.log('\nðŸ Research complete!');
}

// Run the main function with error handling
main().catch(error => {
  console.error('âŒ Error:', error);
  process.exit(1);
});

```

### mastra/index.ts
```typescript
import { Mastra } from '@mastra/core';
import { PinoLogger } from '@mastra/loggers';
// import { researchNetwork } from './network';
import { webSearchAgent, synthesizeAgent } from './agents';
import { planningAgent } from './agents/planning';
import { travelAgent, summaryAgent } from './agents/travelAgent';
// import { agentWorkflow } from './workflows';
import { v_nextNetwork } from './network/v-next';
import { LibSQLStore } from '@mastra/libsql';
import { workflow1 } from './network/v-next';
import { travelAgentWorkflow } from './workflows/step4';
import { incrementWorkflow } from './workflows/step5';
import { weatherWorkflow } from './workflows/step3';

export const mastra = new Mastra({
  agents: {
    webSearchAgent,
    planningAgent,
    travelAgent,
    summaryTravelAgent: summaryAgent,
    synthesizeAgent,
  },
  // networks: {
  //   researchNetwork,
  // },
  vnext_networks: {
    v_nextNetwork,
  },
  storage: new LibSQLStore({
    url: 'file:../mastra.db', // Or your database URL
  }),
  workflows: {
    workflow1,
    travelAgentWorkflow,
    incrementWorkflow,
    weatherWorkflow,
  },
  logger: new PinoLogger({ name: 'Chef', level: 'info' }),
  serverMiddleware: [
    {
      handler: (c, next) => {
        console.log('Middleware called');
        return next();
      },
    },
  ],
});

```

### mastra/network/index.ts
```typescript
import { openai } from '@ai-sdk/openai';
import { AgentNetwork } from '@mastra/core/network';
import {
  primaryResearchAgent,
  webSearchAgent,
  academicResearchAgent,
  factCheckingAgent,
  dataAnalysisAgent,
} from '../agents';

export const researchNetwork = new AgentNetwork({
  name: 'Research Network',
  agents: [primaryResearchAgent, webSearchAgent, academicResearchAgent, factCheckingAgent, dataAnalysisAgent],
  model: openai('gpt-4o'), // Add the model property which is required
  instructions: `
      You are a research coordination system that routes queries to the appropriate specialized agents.
      
      Your available agents are:
      1. Primary Research Agent: Coordinates research efforts, breaks down complex questions, and synthesizes information
      2. Web Search Agent: Finds up-to-date information online with proper citations
      3. Academic Research Agent: Provides academic perspectives, theories, and scholarly context
      4. Fact Checking Agent: Verifies claims and identifies potential misinformation
      5. Data Analysis Agent: Interprets numerical data, statistics, and identifies patterns
      
      For each user query:
      1. Start with the Primary Research Agent to analyze the query and break it down
      2. Route sub-questions to the appropriate specialized agents based on their expertise
      3. Use the Fact Checking Agent to verify important claims when necessary
      4. Return to the Primary Research Agent to synthesize all findings into a comprehensive response
      
      Always maintain a chain of evidence and proper attribution between agents.
    `,
});

```

### mastra/network/v-next.ts
```typescript
import { openai } from '@ai-sdk/openai';
import { anthropic } from '@ai-sdk/anthropic';
import { NewAgentNetwork } from '@mastra/core/network/vNext';
import { Agent } from '@mastra/core/agent';
import { createStep, createWorkflow } from '@mastra/core/workflows';
import { LibSQLStore } from '@mastra/libsql';
import { Memory } from '@mastra/memory';
import { z } from 'zod';
import { weatherAgent } from '../agents';
import { weatherTool } from '../tools';

const memory = new Memory({
  storage: new LibSQLStore({
    url: 'file:../mastra.db', // Or your database URL
  }),
});

const agent1 = new Agent({
  name: 'agent1',
  instructions:
    'This agent is used to do research, but not create full responses. Answer in bullet points only and be concise.',
  description:
    'This agent is used to do research, but not create full responses. Answer in bullet points only and be concise.',
  model: openai('gpt-4o'),
});

const agent2 = new Agent({
  name: 'agent2',
  description: 'This agent is used to do text synthesis on researched material. It writes articles in full paragraphs.',
  instructions:
    'This agent is used to do text synthesis on researched material. Write a full report based on the researched material. Do not use bullet points. Write full paragraphs. There should not be a single bullet point in the final report. You write articles.',
  model: openai('gpt-4o'),
});

const agentStep1 = createStep({
  id: 'agent-workflow-step-1',
  description: 'This step is used to do research and text synthesis.',
  inputSchema: z.object({
    city: z.string().describe('The city to research'),
  }),
  outputSchema: z.object({
    text: z.string(),
  }),
  execute: async ({ inputData }) => {
    const resp = await agent1.generate(inputData.city, {
      output: z.object({
        text: z.string(),
      }),
    });

    return { text: resp.object.text };
  },
});

const agentStep2 = createStep({
  id: 'agent-workflow-step-2',
  description: 'This step is used to do research and text synthesis.',
  inputSchema: z.object({
    text: z.string().describe('The city to research'),
  }),
  outputSchema: z.object({
    text: z.string(),
  }),
  execute: async ({ inputData }) => {
    const resp = await agent2.generate(inputData.text, {
      output: z.object({
        text: z.string(),
      }),
    });

    return { text: resp.object.text };
  },
});

export const workflow1 = createWorkflow({
  id: 'workflow1',
  description: 'This workflow is perfect for researching a specific city.',
  inputSchema: z.object({
    city: z.string(),
  }),
  outputSchema: z.object({
    text: z.string(),
  }),
})
  .then(agentStep1)
  .then(agentStep2)
  .commit();

export const v_nextNetwork = new NewAgentNetwork({
  id: 'test-network',
  name: 'Test Network',
  instructions:
    'You can research cities. You can also synthesize research material. You can also write a full report based on the researched material. You can also get weather information. workflow1 is the best primitive for researching an *individual* city and it should always be used when running multiple primitives to accomplish a task.',
  model: openai('gpt-4o'),
  agents: {
    agent1,
    agent2,
    // weatherAgent,
  },
  tools: {
    weatherTool,
  },
  workflows: {
    workflow1,
  },
  memory: memory,
});

```

### mastra/workflows/index.ts
```typescript
import { Workflow } from '@mastra/core/workflows';
import { z } from 'zod';
import { webSearchAgent } from '../agents';

export const agentWorkflow = new Workflow({
  name: 'Agent Workflow',
  steps: [webSearchAgent.toStep()],
  triggerSchema: z.object({
    prompt: z.string(),
  }),
});

agentWorkflow
  .step(webSearchAgent, {
    variables: {
      prompt: {
        step: 'trigger',
        path: 'prompt',
      },
    },
  })
  .commit();

```
